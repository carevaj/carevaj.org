import { isUrl, normalizePath } from "../core/utils/path.ts";
import { merge } from "../core/utils/object.ts";
import { log } from "../core/utils/log.ts";
import { read } from "../core/utils/read.ts";
import { concurrent } from "../core/utils/concurrent.ts";
import { encodeBase64 } from "../deps/base64.ts";
import { Page } from "../core/file.ts";
import { basename, join, toFileUrl } from "../deps/path.ts";
export const defaults = {
  inline: false,
  sourceContent: false
};
/** Generate the source map files of assets */ export default function(userOptions) {
  const options = merge(defaults, userOptions);
  return (site)=>{
    site._data.enableSourceMap = true;
    site.process("*", (pages, allPages)=>concurrent(pages, (page)=>processSourceMap(page, allPages)));
    async function processSourceMap(file, files) {
      const sourceMap = file.data.sourceMap;
      file.data.sourceMap = undefined;
      if (!sourceMap) {
        return;
      }
      // Add the content of the source files
      try {
        if (options.sourceContent) {
          sourceMap.sourcesContent = await Promise.all(sourceMap.sources.map((url)=>{
            const content = sourceMap[dynamicSourcesSymbol]?.[url];
            return content ? content : read(url, false);
          }));
        }
      } catch (err) {
        log.error(`${err.message}\n${sourceMap.sources.join("\n")}`);
      }
      // Relative paths (eg. "../bar") look better in the dev-tools.
      sourceMap.sourceRoot = toFileUrl(site.root()).href;
      sourceMap.sources = sourceMap.sources.map((url)=>url.replace(sourceMap.sourceRoot, ""));
      // Inline the source map in the output file
      if (options.inline) {
        const url = `data:application/json;charset=utf-8;base64,${encodeBase64(JSON.stringify(sourceMap))}`;
        file.content += addSourceMap(file.outputPath, url);
        return;
      }
      // Create a source map file
      const url = file.outputPath + ".map";
      sourceMap.file = url;
      file.content += addSourceMap(file.outputPath, `./${basename(url)}`);
      files.push(Page.create({
        url,
        content: JSON.stringify(sourceMap)
      }));
    }
  };
}
/** Utilities to use by other plugins to manage source maps */ export const dynamicSourcesSymbol = Symbol.for("dynamicSources");
/** Return the required info to process a file */ export function prepareAsset(site, page) {
  const enableSourceMap = !!site._data.enableSourceMap;
  const content = page.content;
  const sourceMap = enableSourceMap ? page.data.sourceMap : undefined;
  const filename = page.src.path ? site.src(page.src.path + page.src.ext) : site.src(page.outputPath);
  return {
    content,
    sourceMap,
    filename,
    enableSourceMap
  };
}
/** Save the process result */ export function saveAsset(site, page, content, sourceMap) {
  if (!site._data.enableSourceMap) {
    sourceMap = undefined;
  }
  // There's no source map
  if (!sourceMap) {
    page.content = content;
    return;
  }
  const root = site.root();
  // Ensure the sourceMap is an object
  if (typeof sourceMap === "string") {
    sourceMap = JSON.parse(sourceMap);
  }
  // Normalize any source url
  function normalizeSource(source) {
    if (source.startsWith("deno:")) {
      source = source.substring(5);
    }
    if (isUrl(source)) {
      return source;
    }
    source = normalizePath(source);
    return source.startsWith(root) ? toFileUrl(decodeURIComponent(source)).href : toFileUrl(decodeURIComponent(join(root, source))).href;
  }
  sourceMap.sources = sourceMap.sources.filter((source)=>source !== "<no source>") // tailwindcss
  .map(normalizeSource);
  // Inherit the dynamic sources from the previous source map
  const previousSourceMap = page.data.sourceMap;
  if (previousSourceMap) {
    sourceMap[dynamicSourcesSymbol] = previousSourceMap[dynamicSourcesSymbol];
  }
  // If it's a dynamic source (not from the file system), store it in the source map
  if (!page.src.path) {
    const sources = sourceMap[dynamicSourcesSymbol] || {};
    const file = normalizeSource(site.src(page.outputPath));
    sourceMap[dynamicSourcesSymbol] = sources;
    if (!sources[file]) {
      sources[file] = page.content;
    }
  }
  // Store the new content and source map
  page.data.sourceMap = sourceMap;
  page.content = content;
}
function addSourceMap(url, sourceMap) {
  if (url.endsWith(".js")) {
    return `\n//# sourceMappingURL=${sourceMap}`;
  }
  // It's CSS
  return `\n/*# sourceMappingURL=${sourceMap} */`;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvbHVtZUB2Mi4yLjAvcGx1Z2lucy9zb3VyY2VfbWFwcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1VybCwgbm9ybWFsaXplUGF0aCB9IGZyb20gXCIuLi9jb3JlL3V0aWxzL3BhdGgudHNcIjtcbmltcG9ydCB7IG1lcmdlIH0gZnJvbSBcIi4uL2NvcmUvdXRpbHMvb2JqZWN0LnRzXCI7XG5pbXBvcnQgeyBsb2cgfSBmcm9tIFwiLi4vY29yZS91dGlscy9sb2cudHNcIjtcbmltcG9ydCB7IHJlYWQgfSBmcm9tIFwiLi4vY29yZS91dGlscy9yZWFkLnRzXCI7XG5pbXBvcnQgeyBjb25jdXJyZW50IH0gZnJvbSBcIi4uL2NvcmUvdXRpbHMvY29uY3VycmVudC50c1wiO1xuaW1wb3J0IHsgZW5jb2RlQmFzZTY0IH0gZnJvbSBcIi4uL2RlcHMvYmFzZTY0LnRzXCI7XG5pbXBvcnQgeyBQYWdlIH0gZnJvbSBcIi4uL2NvcmUvZmlsZS50c1wiO1xuaW1wb3J0IHsgYmFzZW5hbWUsIGpvaW4sIHRvRmlsZVVybCB9IGZyb20gXCIuLi9kZXBzL3BhdGgudHNcIjtcblxuaW1wb3J0IHR5cGUgU2l0ZSBmcm9tIFwiLi4vY29yZS9zaXRlLnRzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3B0aW9ucyB7XG4gIC8qKiBTZXQgdHJ1ZSB0byBpbmxpbmUgdGhlIHNvdXJjZSBtYXAgaW4gdGhlIG91dHB1dCBmaWxlICovXG4gIGlubGluZT86IGJvb2xlYW47XG5cbiAgLyoqIFNldCB0cnVlIHRvIGluY2x1ZGUgdGhlIGNvbnRlbnQgb2YgdGhlIHNvdXJjZSBmaWxlcyAqL1xuICBzb3VyY2VDb250ZW50PzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRzOiBPcHRpb25zID0ge1xuICBpbmxpbmU6IGZhbHNlLFxuICBzb3VyY2VDb250ZW50OiBmYWxzZSxcbn07XG5cbi8qKiBHZW5lcmF0ZSB0aGUgc291cmNlIG1hcCBmaWxlcyBvZiBhc3NldHMgKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uICh1c2VyT3B0aW9ucz86IE9wdGlvbnMpIHtcbiAgY29uc3Qgb3B0aW9ucyA9IG1lcmdlKGRlZmF1bHRzLCB1c2VyT3B0aW9ucyk7XG5cbiAgcmV0dXJuIChzaXRlOiBTaXRlKSA9PiB7XG4gICAgc2l0ZS5fZGF0YS5lbmFibGVTb3VyY2VNYXAgPSB0cnVlO1xuXG4gICAgc2l0ZS5wcm9jZXNzKFxuICAgICAgXCIqXCIsXG4gICAgICAocGFnZXMsIGFsbFBhZ2VzKSA9PlxuICAgICAgICBjb25jdXJyZW50KHBhZ2VzLCAocGFnZSkgPT4gcHJvY2Vzc1NvdXJjZU1hcChwYWdlLCBhbGxQYWdlcykpLFxuICAgICk7XG5cbiAgICBhc3luYyBmdW5jdGlvbiBwcm9jZXNzU291cmNlTWFwKGZpbGU6IFBhZ2UsIGZpbGVzOiBQYWdlW10pIHtcbiAgICAgIGNvbnN0IHNvdXJjZU1hcCA9IGZpbGUuZGF0YS5zb3VyY2VNYXAgYXMgU291cmNlTWFwIHwgdW5kZWZpbmVkO1xuICAgICAgZmlsZS5kYXRhLnNvdXJjZU1hcCA9IHVuZGVmaW5lZDtcblxuICAgICAgaWYgKCFzb3VyY2VNYXApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgdGhlIGNvbnRlbnQgb2YgdGhlIHNvdXJjZSBmaWxlc1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKG9wdGlvbnMuc291cmNlQ29udGVudCkge1xuICAgICAgICAgIHNvdXJjZU1hcC5zb3VyY2VzQ29udGVudCA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgc291cmNlTWFwLnNvdXJjZXMubWFwKCh1cmw6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gc291cmNlTWFwW2R5bmFtaWNTb3VyY2VzU3ltYm9sXT8uW3VybF07XG5cbiAgICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQgPyBjb250ZW50IDogcmVhZCh1cmwsIGZhbHNlKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cuZXJyb3IoYCR7ZXJyLm1lc3NhZ2V9XFxuJHtzb3VyY2VNYXAuc291cmNlcy5qb2luKFwiXFxuXCIpfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBSZWxhdGl2ZSBwYXRocyAoZWcuIFwiLi4vYmFyXCIpIGxvb2sgYmV0dGVyIGluIHRoZSBkZXYtdG9vbHMuXG4gICAgICBzb3VyY2VNYXAuc291cmNlUm9vdCA9IHRvRmlsZVVybChzaXRlLnJvb3QoKSkuaHJlZjtcbiAgICAgIHNvdXJjZU1hcC5zb3VyY2VzID0gc291cmNlTWFwLnNvdXJjZXMubWFwKCh1cmw6IHN0cmluZykgPT5cbiAgICAgICAgdXJsLnJlcGxhY2Uoc291cmNlTWFwLnNvdXJjZVJvb3QhLCBcIlwiKVxuICAgICAgKTtcblxuICAgICAgLy8gSW5saW5lIHRoZSBzb3VyY2UgbWFwIGluIHRoZSBvdXRwdXQgZmlsZVxuICAgICAgaWYgKG9wdGlvbnMuaW5saW5lKSB7XG4gICAgICAgIGNvbnN0IHVybCA9IGBkYXRhOmFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtODtiYXNlNjQsJHtcbiAgICAgICAgICBlbmNvZGVCYXNlNjQoSlNPTi5zdHJpbmdpZnkoc291cmNlTWFwKSlcbiAgICAgICAgfWA7XG4gICAgICAgIGZpbGUuY29udGVudCArPSBhZGRTb3VyY2VNYXAoZmlsZS5vdXRwdXRQYXRoLCB1cmwpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSBhIHNvdXJjZSBtYXAgZmlsZVxuICAgICAgY29uc3QgdXJsID0gZmlsZS5vdXRwdXRQYXRoICsgXCIubWFwXCI7XG4gICAgICBzb3VyY2VNYXAuZmlsZSA9IHVybDtcbiAgICAgIGZpbGUuY29udGVudCArPSBhZGRTb3VyY2VNYXAoZmlsZS5vdXRwdXRQYXRoLCBgLi8ke2Jhc2VuYW1lKHVybCl9YCk7XG4gICAgICBmaWxlcy5wdXNoKFBhZ2UuY3JlYXRlKHsgdXJsLCBjb250ZW50OiBKU09OLnN0cmluZ2lmeShzb3VyY2VNYXApIH0pKTtcbiAgICB9XG4gIH07XG59XG5cbi8qKiBVdGlsaXRpZXMgdG8gdXNlIGJ5IG90aGVyIHBsdWdpbnMgdG8gbWFuYWdlIHNvdXJjZSBtYXBzICovXG5leHBvcnQgY29uc3QgZHluYW1pY1NvdXJjZXNTeW1ib2wgPSBTeW1ib2wuZm9yKFwiZHluYW1pY1NvdXJjZXNcIik7XG5cbi8qKiBTb3VyY2VNYXAgd2l0aCBhIHByb3BlcnR5IHRvIHN0b3JlIGR5bmFtaWMgc291cmNlcyAqL1xuZXhwb3J0IGludGVyZmFjZSBTb3VyY2VNYXAge1xuICB2ZXJzaW9uOiBudW1iZXI7XG4gIGZpbGU/OiBzdHJpbmc7XG4gIHNvdXJjZXM6IHJlYWRvbmx5IHN0cmluZ1tdO1xuICBzb3VyY2VSb290Pzogc3RyaW5nO1xuICBzb3VyY2VzQ29udGVudD86IHJlYWRvbmx5IChzdHJpbmcgfCBudWxsKVtdO1xuICBuYW1lczogcmVhZG9ubHkgc3RyaW5nW107XG4gIG1hcHBpbmdzOiBzdHJpbmc7XG4gIFtkeW5hbWljU291cmNlc1N5bWJvbF0/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByZXBhcmVSZXN1bHQge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHNvdXJjZU1hcD86IFNvdXJjZU1hcDtcbiAgZmlsZW5hbWU6IHN0cmluZztcbiAgZW5hYmxlU291cmNlTWFwOiBib29sZWFuO1xufVxuXG4vKiogUmV0dXJuIHRoZSByZXF1aXJlZCBpbmZvIHRvIHByb2Nlc3MgYSBmaWxlICovXG5leHBvcnQgZnVuY3Rpb24gcHJlcGFyZUFzc2V0KHNpdGU6IFNpdGUsIHBhZ2U6IFBhZ2UpOiBQcmVwYXJlUmVzdWx0IHtcbiAgY29uc3QgZW5hYmxlU291cmNlTWFwID0gISFzaXRlLl9kYXRhLmVuYWJsZVNvdXJjZU1hcDtcbiAgY29uc3QgY29udGVudCA9IHBhZ2UuY29udGVudCBhcyBzdHJpbmc7XG4gIGNvbnN0IHNvdXJjZU1hcCA9IGVuYWJsZVNvdXJjZU1hcFxuICAgID8gcGFnZS5kYXRhLnNvdXJjZU1hcCBhcyBTb3VyY2VNYXAgfCB1bmRlZmluZWRcbiAgICA6IHVuZGVmaW5lZDtcbiAgY29uc3QgZmlsZW5hbWUgPSBwYWdlLnNyYy5wYXRoXG4gICAgPyBzaXRlLnNyYyhwYWdlLnNyYy5wYXRoICsgcGFnZS5zcmMuZXh0KVxuICAgIDogc2l0ZS5zcmMocGFnZS5vdXRwdXRQYXRoKTtcbiAgcmV0dXJuIHsgY29udGVudCwgc291cmNlTWFwLCBmaWxlbmFtZSwgZW5hYmxlU291cmNlTWFwIH07XG59XG5cbi8qKiBTYXZlIHRoZSBwcm9jZXNzIHJlc3VsdCAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhdmVBc3NldChcbiAgc2l0ZTogU2l0ZSxcbiAgcGFnZTogUGFnZSxcbiAgY29udGVudDogc3RyaW5nLFxuICBzb3VyY2VNYXA/OiBTb3VyY2VNYXAgfCBzdHJpbmcsXG4pIHtcbiAgaWYgKCFzaXRlLl9kYXRhLmVuYWJsZVNvdXJjZU1hcCkge1xuICAgIHNvdXJjZU1hcCA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8vIFRoZXJlJ3Mgbm8gc291cmNlIG1hcFxuICBpZiAoIXNvdXJjZU1hcCkge1xuICAgIHBhZ2UuY29udGVudCA9IGNvbnRlbnQ7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgcm9vdCA9IHNpdGUucm9vdCgpO1xuXG4gIC8vIEVuc3VyZSB0aGUgc291cmNlTWFwIGlzIGFuIG9iamVjdFxuICBpZiAodHlwZW9mIHNvdXJjZU1hcCA9PT0gXCJzdHJpbmdcIikge1xuICAgIHNvdXJjZU1hcCA9IEpTT04ucGFyc2Uoc291cmNlTWFwKSBhcyBTb3VyY2VNYXA7XG4gIH1cblxuICAvLyBOb3JtYWxpemUgYW55IHNvdXJjZSB1cmxcbiAgZnVuY3Rpb24gbm9ybWFsaXplU291cmNlKHNvdXJjZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAoc291cmNlLnN0YXJ0c1dpdGgoXCJkZW5vOlwiKSkgeyAvLyBlc2J1aWxkXG4gICAgICBzb3VyY2UgPSBzb3VyY2Uuc3Vic3RyaW5nKDUpO1xuICAgIH1cbiAgICBpZiAoaXNVcmwoc291cmNlKSkge1xuICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICB9XG5cbiAgICBzb3VyY2UgPSBub3JtYWxpemVQYXRoKHNvdXJjZSk7XG5cbiAgICByZXR1cm4gc291cmNlLnN0YXJ0c1dpdGgocm9vdClcbiAgICAgID8gdG9GaWxlVXJsKGRlY29kZVVSSUNvbXBvbmVudChzb3VyY2UpKS5ocmVmXG4gICAgICA6IHRvRmlsZVVybChkZWNvZGVVUklDb21wb25lbnQoam9pbihyb290LCBzb3VyY2UpKSkuaHJlZjtcbiAgfVxuXG4gIHNvdXJjZU1hcC5zb3VyY2VzID0gc291cmNlTWFwLnNvdXJjZXNcbiAgICAuZmlsdGVyKChzb3VyY2U6IHN0cmluZykgPT4gc291cmNlICE9PSBcIjxubyBzb3VyY2U+XCIpIC8vIHRhaWx3aW5kY3NzXG4gICAgLm1hcChub3JtYWxpemVTb3VyY2UpO1xuXG4gIC8vIEluaGVyaXQgdGhlIGR5bmFtaWMgc291cmNlcyBmcm9tIHRoZSBwcmV2aW91cyBzb3VyY2UgbWFwXG4gIGNvbnN0IHByZXZpb3VzU291cmNlTWFwID0gcGFnZS5kYXRhLnNvdXJjZU1hcCBhcyBTb3VyY2VNYXAgfCB1bmRlZmluZWQ7XG4gIGlmIChwcmV2aW91c1NvdXJjZU1hcCkge1xuICAgIHNvdXJjZU1hcFtkeW5hbWljU291cmNlc1N5bWJvbF0gPSBwcmV2aW91c1NvdXJjZU1hcFtkeW5hbWljU291cmNlc1N5bWJvbF07XG4gIH1cblxuICAvLyBJZiBpdCdzIGEgZHluYW1pYyBzb3VyY2UgKG5vdCBmcm9tIHRoZSBmaWxlIHN5c3RlbSksIHN0b3JlIGl0IGluIHRoZSBzb3VyY2UgbWFwXG4gIGlmICghcGFnZS5zcmMucGF0aCkge1xuICAgIGNvbnN0IHNvdXJjZXMgPSBzb3VyY2VNYXBbZHluYW1pY1NvdXJjZXNTeW1ib2xdIHx8IHt9O1xuICAgIGNvbnN0IGZpbGUgPSBub3JtYWxpemVTb3VyY2Uoc2l0ZS5zcmMocGFnZS5vdXRwdXRQYXRoKSk7XG4gICAgc291cmNlTWFwW2R5bmFtaWNTb3VyY2VzU3ltYm9sXSA9IHNvdXJjZXM7XG5cbiAgICBpZiAoIXNvdXJjZXNbZmlsZV0pIHtcbiAgICAgIHNvdXJjZXNbZmlsZV0gPSBwYWdlLmNvbnRlbnQgYXMgc3RyaW5nO1xuICAgIH1cbiAgfVxuXG4gIC8vIFN0b3JlIHRoZSBuZXcgY29udGVudCBhbmQgc291cmNlIG1hcFxuICBwYWdlLmRhdGEuc291cmNlTWFwID0gc291cmNlTWFwO1xuICBwYWdlLmNvbnRlbnQgPSBjb250ZW50O1xufVxuXG5mdW5jdGlvbiBhZGRTb3VyY2VNYXAodXJsOiBzdHJpbmcsIHNvdXJjZU1hcDogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKHVybC5lbmRzV2l0aChcIi5qc1wiKSkge1xuICAgIHJldHVybiBgXFxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9JHtzb3VyY2VNYXB9YDtcbiAgfVxuXG4gIC8vIEl0J3MgQ1NTXG4gIHJldHVybiBgXFxuLyojIHNvdXJjZU1hcHBpbmdVUkw9JHtzb3VyY2VNYXB9ICovYDtcbn1cblxuLyoqIEV4dGVuZHMgRGF0YSBpbnRlcmZhY2UgKi9cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgbmFtZXNwYWNlIEx1bWUge1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgRGF0YSB7XG4gICAgICAvKipcbiAgICAgICAqIFRoZSBzb3VyY2UgbWFwIGRhdGEgKGlmIGl0J3MgYW4gYXNzZXQpXG4gICAgICAgKiBAc2VlIGh0dHBzOi8vbHVtZS5sYW5kL3BsdWdpbnMvc291cmNlX21hcHMvXG4gICAgICAgKi9cbiAgICAgIHNvdXJjZU1hcD86IFNvdXJjZU1hcDtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTLEtBQUssRUFBRSxhQUFhLFFBQVEsd0JBQXdCO0FBQzdE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