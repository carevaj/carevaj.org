import { brightGreen, gray, red } from "../deps/colors.ts";
/** Log the request/responses */ export default function log() {
  return async (request, next)=>{
    try {
      const response = await next(request);
      const url = new URL(request.url);
      const pathname = decodeURIComponent(url.pathname);
      const { status } = response;
      if (status === 404 || status === 500) {
        console.log(`${red(status.toString())} ${pathname}`);
      } else if (status === 200) {
        console.log(`${brightGreen(status.toString())} ${pathname}`);
      } else if (status === 301 || status === 302) {
        console.log(`${gray(status.toString())} ${pathname} => ${response.headers?.get("location")}`);
      } else {
        console.log(`${gray(status.toString())} ${pathname}`);
      }
      return response;
    } catch (cause) {
      return new Response(`Error: ${cause.toString()}`, {
        status: 500
      });
    }
  };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvbHVtZUB2Mi4yLjAvbWlkZGxld2FyZXMvbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJyaWdodEdyZWVuLCBncmF5LCByZWQgfSBmcm9tIFwiLi4vZGVwcy9jb2xvcnMudHNcIjtcblxuaW1wb3J0IHR5cGUgeyBNaWRkbGV3YXJlIH0gZnJvbSBcIi4uL2NvcmUvc2VydmVyLnRzXCI7XG5cbi8qKiBMb2cgdGhlIHJlcXVlc3QvcmVzcG9uc2VzICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBsb2coKTogTWlkZGxld2FyZSB7XG4gIHJldHVybiBhc3luYyAocmVxdWVzdCwgbmV4dCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG5leHQocmVxdWVzdCk7XG4gICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICAgIGNvbnN0IHBhdGhuYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHVybC5wYXRobmFtZSk7XG4gICAgICBjb25zdCB7IHN0YXR1cyB9ID0gcmVzcG9uc2U7XG5cbiAgICAgIGlmIChzdGF0dXMgPT09IDQwNCB8fCBzdGF0dXMgPT09IDUwMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgJHtyZWQoc3RhdHVzLnRvU3RyaW5nKCkpfSAke3BhdGhuYW1lfWApO1xuICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDIwMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgJHticmlnaHRHcmVlbihzdGF0dXMudG9TdHJpbmcoKSl9ICR7cGF0aG5hbWV9YCk7XG4gICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gMzAxIHx8IHN0YXR1cyA9PT0gMzAyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIGAke2dyYXkoc3RhdHVzLnRvU3RyaW5nKCkpfSAke3BhdGhuYW1lfSA9PiAke1xuICAgICAgICAgICAgcmVzcG9uc2UuaGVhZGVycz8uZ2V0KFxuICAgICAgICAgICAgICBcImxvY2F0aW9uXCIsXG4gICAgICAgICAgICApXG4gICAgICAgICAgfWAsXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhgJHtncmF5KHN0YXR1cy50b1N0cmluZygpKX0gJHtwYXRobmFtZX1gKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGNhdXNlKSB7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgICBgRXJyb3I6ICR7Y2F1c2UudG9TdHJpbmcoKX1gLFxuICAgICAgICB7IHN0YXR1czogNTAwIH0sXG4gICAgICApO1xuICAgIH1cbiAgfTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTLFdBQVcsRUFBRSxJQUFJLEVBQUUsR0FBRyxRQUFRLG9CQUFvQjtBQUkzRCw4QkFBOEIsR0FDOUIsZUFBZSxTQUFTO0VBQ3RCLE9BQU8sT0FBTyxTQUFTO0lBQ3JCLElBQUk7TUFDRixNQUFNLFdBQVcsTUFBTSxLQUFLO01BQzVCLE1BQU0sTUFBTSxJQUFJLElBQUksUUFBUSxHQUFHO01BQy9CLE1BQU0sV0FBVyxtQkFBbUIsSUFBSSxRQUFRO01BQ2hELE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRztNQUVuQixJQUFJLFdBQVcsT0FBTyxXQUFXLEtBQUs7UUFDcEMsUUFBUSxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksT0FBTyxRQUFRLElBQUksQ0FBQyxFQUFFLFNBQVMsQ0FBQztNQUNyRCxPQUFPLElBQUksV0FBVyxLQUFLO1FBQ3pCLFFBQVEsR0FBRyxDQUFDLENBQUMsRUFBRSxZQUFZLE9BQU8sUUFBUSxJQUFJLENBQUMsRUFBRSxTQUFTLENBQUM7TUFDN0QsT0FBTyxJQUFJLFdBQVcsT0FBTyxXQUFXLEtBQUs7UUFDM0MsUUFBUSxHQUFHLENBQ1QsQ0FBQyxFQUFFLEtBQUssT0FBTyxRQUFRLElBQUksQ0FBQyxFQUFFLFNBQVMsSUFBSSxFQUN6QyxTQUFTLE9BQU8sRUFBRSxJQUNoQixZQUVILENBQUM7TUFFTixPQUFPO1FBQ0wsUUFBUSxHQUFHLENBQUMsQ0FBQyxFQUFFLEtBQUssT0FBTyxRQUFRLElBQUksQ0FBQyxFQUFFLFNBQVMsQ0FBQztNQUN0RDtNQUVBLE9BQU87SUFDVCxFQUFFLE9BQU8sT0FBTztNQUNkLE9BQU8sSUFBSSxTQUNULENBQUMsT0FBTyxFQUFFLE1BQU0sUUFBUSxHQUFHLENBQUMsRUFDNUI7UUFBRSxRQUFRO01BQUk7SUFFbEI7RUFDRjtBQUNGIn0=