import { merge } from "../core/utils/object.ts";
import { matchExtension } from "../core/utils/path.ts";
import createSlugifier, { defaults as slugifierDefaults } from "../core/slugifier.ts";
// Default options
export const defaults = {
  extensions: [
    ".html"
  ],
  ...slugifierDefaults
};
/** A plugin to slugify all URLs, replacing non-URL-safe characters */ export default function(userOptions) {
  const options = merge(defaults, userOptions);
  const slugify = createSlugifier(options);
  return (site)=>{
    site.filter("slugify", slugify);
    site.preprocess(options.extensions, (pages)=>pages.forEach(slugifyUrls));
    // Slugify the static files
    site.addEventListener("beforeRender", ()=>{
      site.files.filter((file)=>matchExtension(options.extensions, file.outputPath)).forEach((file)=>file.outputPath = slugify(file.outputPath));
    });
  };
  function slugifyUrls(page) {
    if (typeof page.data.url === "string") {
      page.data.url = slugify(page.data.url);
    }
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvbHVtZUB2Mi4yLjAvcGx1Z2lucy9zbHVnaWZ5X3VybHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWVyZ2UgfSBmcm9tIFwiLi4vY29yZS91dGlscy9vYmplY3QudHNcIjtcbmltcG9ydCB7IG1hdGNoRXh0ZW5zaW9uIH0gZnJvbSBcIi4uL2NvcmUvdXRpbHMvcGF0aC50c1wiO1xuaW1wb3J0IGNyZWF0ZVNsdWdpZmllciwge1xuICBkZWZhdWx0cyBhcyBzbHVnaWZpZXJEZWZhdWx0cyxcbn0gZnJvbSBcIi4uL2NvcmUvc2x1Z2lmaWVyLnRzXCI7XG5cbmltcG9ydCB0eXBlIFNpdGUgZnJvbSBcIi4uL2NvcmUvc2l0ZS50c1wiO1xuaW1wb3J0IHR5cGUgeyBQYWdlIH0gZnJvbSBcIi4uL2NvcmUvZmlsZS50c1wiO1xuaW1wb3J0IHR5cGUgeyBFeHRlbnNpb25zIH0gZnJvbSBcIi4uL2NvcmUvdXRpbHMvcGF0aC50c1wiO1xuaW1wb3J0IHR5cGUgeyBPcHRpb25zIGFzIFNsdWdpZmllck9wdGlvbnMgfSBmcm9tIFwiLi4vY29yZS9zbHVnaWZpZXIudHNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBPcHRpb25zIGV4dGVuZHMgU2x1Z2lmaWVyT3B0aW9ucyB7XG4gIC8qKiBUaGUgbGlzdCBvZiBleHRlbnNpb25zIHRoaXMgcGx1Z2luIGFwcGxpZXMgdG8gKi9cbiAgZXh0ZW5zaW9ucz86IEV4dGVuc2lvbnM7XG59XG5cbi8vIERlZmF1bHQgb3B0aW9uc1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRzOiBPcHRpb25zID0ge1xuICBleHRlbnNpb25zOiBbXCIuaHRtbFwiXSxcbiAgLi4uc2x1Z2lmaWVyRGVmYXVsdHMsXG59O1xuXG4vKiogQSBwbHVnaW4gdG8gc2x1Z2lmeSBhbGwgVVJMcywgcmVwbGFjaW5nIG5vbi1VUkwtc2FmZSBjaGFyYWN0ZXJzICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAodXNlck9wdGlvbnM/OiBPcHRpb25zKSB7XG4gIGNvbnN0IG9wdGlvbnMgPSBtZXJnZShkZWZhdWx0cywgdXNlck9wdGlvbnMpO1xuICBjb25zdCBzbHVnaWZ5ID0gY3JlYXRlU2x1Z2lmaWVyKG9wdGlvbnMpO1xuXG4gIHJldHVybiAoc2l0ZTogU2l0ZSkgPT4ge1xuICAgIHNpdGUuZmlsdGVyKFwic2x1Z2lmeVwiLCBzbHVnaWZ5KTtcbiAgICBzaXRlLnByZXByb2Nlc3Mob3B0aW9ucy5leHRlbnNpb25zLCAocGFnZXMpID0+IHBhZ2VzLmZvckVhY2goc2x1Z2lmeVVybHMpKTtcblxuICAgIC8vIFNsdWdpZnkgdGhlIHN0YXRpYyBmaWxlc1xuICAgIHNpdGUuYWRkRXZlbnRMaXN0ZW5lcihcImJlZm9yZVJlbmRlclwiLCAoKSA9PiB7XG4gICAgICBzaXRlLmZpbGVzXG4gICAgICAgIC5maWx0ZXIoKGZpbGUpID0+IG1hdGNoRXh0ZW5zaW9uKG9wdGlvbnMuZXh0ZW5zaW9ucywgZmlsZS5vdXRwdXRQYXRoKSlcbiAgICAgICAgLmZvckVhY2goKGZpbGUpID0+IGZpbGUub3V0cHV0UGF0aCA9IHNsdWdpZnkoZmlsZS5vdXRwdXRQYXRoKSk7XG4gICAgfSk7XG4gIH07XG5cbiAgZnVuY3Rpb24gc2x1Z2lmeVVybHMocGFnZTogUGFnZSkge1xuICAgIGlmICh0eXBlb2YgcGFnZS5kYXRhLnVybCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcGFnZS5kYXRhLnVybCA9IHNsdWdpZnkocGFnZS5kYXRhLnVybCk7XG4gICAgfVxuICB9XG59XG5cbi8qKiBFeHRlbmRzIEhlbHBlcnMgaW50ZXJmYWNlICovXG5kZWNsYXJlIGdsb2JhbCB7XG4gIG5hbWVzcGFjZSBMdW1lIHtcbiAgICBleHBvcnQgaW50ZXJmYWNlIEhlbHBlcnMge1xuICAgICAgLyoqIEBzZWUgaHR0cHM6Ly9sdW1lLmxhbmQvcGx1Z2lucy9zbHVnaWZ5X3VybHMvICovXG4gICAgICBzbHVnaWZ5OiAoc3RyaW5nOiBzdHJpbmcpID0+IHN0cmluZztcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTLEtBQUssUUFBUSwwQkFBMEI7QUFDaEQsU0FBUyxjQUFjLFFBQVEsd0JBQXdCO0FBQ3ZELE9BQU8sbUJBQ0wsWUFBWSxpQkFBaUIsUUFDeEIsdUJBQXVCO0FBWTlCLGtCQUFrQjtBQUNsQixPQUFPLE1BQU0sV0FBb0I7RUFDL0IsWUFBWTtJQUFDO0dBQVE7RUFDckIsR0FBRyxpQkFBaUI7QUFDdEIsRUFBRTtBQUVGLG9FQUFvRSxHQUNwRSxlQUFlLFNBQVUsV0FBcUI7RUFDNUMsTUFBTSxVQUFVLE1BQU0sVUFBVTtFQUNoQyxNQUFNLFVBQVUsZ0JBQWdCO0VBRWhDLE9BQU8sQ0FBQztJQUNOLEtBQUssTUFBTSxDQUFDLFdBQVc7SUFDdkIsS0FBSyxVQUFVLENBQUMsUUFBUSxVQUFVLEVBQUUsQ0FBQyxRQUFVLE1BQU0sT0FBTyxDQUFDO0lBRTdELDJCQUEyQjtJQUMzQixLQUFLLGdCQUFnQixDQUFDLGdCQUFnQjtNQUNwQyxLQUFLLEtBQUssQ0FDUCxNQUFNLENBQUMsQ0FBQyxPQUFTLGVBQWUsUUFBUSxVQUFVLEVBQUUsS0FBSyxVQUFVLEdBQ25FLE9BQU8sQ0FBQyxDQUFDLE9BQVMsS0FBSyxVQUFVLEdBQUcsUUFBUSxLQUFLLFVBQVU7SUFDaEU7RUFDRjtFQUVBLFNBQVMsWUFBWSxJQUFVO0lBQzdCLElBQUksT0FBTyxLQUFLLElBQUksQ0FBQyxHQUFHLEtBQUssVUFBVTtNQUNyQyxLQUFLLElBQUksQ0FBQyxHQUFHLEdBQUcsUUFBUSxLQUFLLElBQUksQ0FBQyxHQUFHO0lBQ3ZDO0VBQ0Y7QUFDRiJ9