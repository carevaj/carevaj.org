import { GenericInput } from "./_generic_input.ts";
import { bold, brightBlue, dim, stripColor } from "./deps.ts";
import { Figures, getFiguresByKeys } from "./figures.ts";
import { distance } from "../_utils/distance.ts";
/** Generic list prompt representation. */ export class GenericList extends GenericInput {
  options = this.settings.options;
  listIndex = this.getListIndex();
  listOffset = this.getPageOffset(this.listIndex);
  /**
   * Create list separator.
   * @param label Separator label.
   */ static separator(label = "------------") {
    return {
      value: label,
      disabled: true
    };
  }
  /**
   * Set list option defaults.
   * @param option List option.
   */ static mapOption(option) {
    return {
      value: option.value,
      name: typeof option.name === "undefined" ? option.value : option.name,
      disabled: !!option.disabled
    };
  }
  constructor(settings){
    super({
      ...settings,
      keys: {
        previous: settings.search ? [
          "up"
        ] : [
          "up",
          "u",
          "p",
          "8"
        ],
        next: settings.search ? [
          "down"
        ] : [
          "down",
          "d",
          "n",
          "2"
        ],
        previousPage: [
          "pageup",
          "left"
        ],
        nextPage: [
          "pagedown",
          "right"
        ],
        ...settings.keys ?? {}
      }
    });
  }
  match() {
    const input = this.getCurrentInputValue().toLowerCase();
    if (!input.length) {
      this.options = this.settings.options.slice();
    } else {
      this.options = this.settings.options.filter((option)=>match(option.name) || option.name !== option.value && match(option.value)).sort((a, b)=>distance(a.name, input) - distance(b.name, input));
    }
    this.listIndex = Math.max(0, Math.min(this.options.length - 1, this.listIndex));
    this.listOffset = Math.max(0, Math.min(this.options.length - this.getListHeight(), this.listOffset));
    function match(value) {
      return stripColor(value).toLowerCase().includes(input);
    }
  }
  message() {
    let message = `${this.settings.indent}${this.settings.prefix}` + bold(this.settings.message) + this.defaults();
    if (this.settings.search) {
      message += " " + this.settings.searchLabel + " ";
    }
    this.cursor.x = stripColor(message).length + this.inputIndex + 1;
    return message + this.input();
  }
  /** Render options. */ body() {
    return this.getList() + this.getInfo();
  }
  getInfo() {
    if (!this.settings.info) {
      return "";
    }
    const selected = this.listIndex + 1;
    const actions = [
      [
        "Next",
        getFiguresByKeys(this.settings.keys?.next ?? [])
      ],
      [
        "Previous",
        getFiguresByKeys(this.settings.keys?.previous ?? [])
      ],
      [
        "Next Page",
        getFiguresByKeys(this.settings.keys?.nextPage ?? [])
      ],
      [
        "Previous Page",
        getFiguresByKeys(this.settings.keys?.previousPage ?? [])
      ],
      [
        "Submit",
        getFiguresByKeys(this.settings.keys?.submit ?? [])
      ]
    ];
    return "\n" + this.settings.indent + brightBlue(Figures.INFO) + bold(` ${selected}/${this.options.length} `) + actions.map((cur)=>`${cur[0]}: ${bold(cur[1].join(", "))}`).join(", ");
  }
  /** Render options list. */ getList() {
    const list = [];
    const height = this.getListHeight();
    for(let i = this.listOffset; i < this.listOffset + height; i++){
      list.push(this.getListItem(this.options[i], this.listIndex === i));
    }
    if (!list.length) {
      list.push(this.settings.indent + dim("  No matches..."));
    }
    return list.join("\n");
  }
  /** Get options row height. */ getListHeight() {
    return Math.min(this.options.length, this.settings.maxRows || this.options.length);
  }
  getListIndex(value) {
    return Math.max(0, typeof value === "undefined" ? this.options.findIndex((item)=>!item.disabled) || 0 : this.options.findIndex((item)=>item.value === value) || 0);
  }
  getPageOffset(index) {
    if (index === 0) {
      return 0;
    }
    const height = this.getListHeight();
    return Math.floor(index / height) * height;
  }
  /**
   * Find option by value.
   * @param value Value of the option.
   */ getOptionByValue(value) {
    return this.options.find((option)=>option.value === value);
  }
  /** Read user input. */ read() {
    if (!this.settings.search) {
      this.tty.cursorHide();
    }
    return super.read();
  }
  /**
   * Handle user input event.
   * @param event Key event.
   */ async handleEvent(event) {
    switch(true){
      case this.isKey(this.settings.keys, "previous", event):
        this.selectPrevious();
        break;
      case this.isKey(this.settings.keys, "next", event):
        this.selectNext();
        break;
      case this.isKey(this.settings.keys, "nextPage", event):
        this.selectNextPage();
        break;
      case this.isKey(this.settings.keys, "previousPage", event):
        this.selectPreviousPage();
        break;
      default:
        await super.handleEvent(event);
    }
  }
  moveCursorLeft() {
    if (this.settings.search) {
      super.moveCursorLeft();
    }
  }
  moveCursorRight() {
    if (this.settings.search) {
      super.moveCursorRight();
    }
  }
  deleteChar() {
    if (this.settings.search) {
      super.deleteChar();
    }
  }
  deleteCharRight() {
    if (this.settings.search) {
      super.deleteCharRight();
      this.match();
    }
  }
  addChar(char) {
    if (this.settings.search) {
      super.addChar(char);
      this.match();
    }
  }
  /** Select previous option. */ selectPrevious() {
    if (this.options.length < 2) {
      return;
    }
    if (this.listIndex > 0) {
      this.listIndex--;
      if (this.listIndex < this.listOffset) {
        this.listOffset--;
      }
      if (this.options[this.listIndex].disabled) {
        this.selectPrevious();
      }
    } else {
      this.listIndex = this.options.length - 1;
      this.listOffset = this.options.length - this.getListHeight();
      if (this.options[this.listIndex].disabled) {
        this.selectPrevious();
      }
    }
  }
  /** Select next option. */ selectNext() {
    if (this.options.length < 2) {
      return;
    }
    if (this.listIndex < this.options.length - 1) {
      this.listIndex++;
      if (this.listIndex >= this.listOffset + this.getListHeight()) {
        this.listOffset++;
      }
      if (this.options[this.listIndex].disabled) {
        this.selectNext();
      }
    } else {
      this.listIndex = this.listOffset = 0;
      if (this.options[this.listIndex].disabled) {
        this.selectNext();
      }
    }
  }
  /** Select previous page. */ selectPreviousPage() {
    if (this.options?.length) {
      const height = this.getListHeight();
      if (this.listOffset >= height) {
        this.listIndex -= height;
        this.listOffset -= height;
      } else if (this.listOffset > 0) {
        this.listIndex -= this.listOffset;
        this.listOffset = 0;
      }
    }
  }
  /** Select next page. */ selectNextPage() {
    if (this.options?.length) {
      const height = this.getListHeight();
      if (this.listOffset + height + height < this.options.length) {
        this.listIndex += height;
        this.listOffset += height;
      } else if (this.listOffset + height < this.options.length) {
        const offset = this.options.length - height;
        this.listIndex += offset - this.listOffset;
        this.listOffset = offset;
      }
    }
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvY2xpZmZ5QHYwLjI1LjcvcHJvbXB0L19nZW5lcmljX2xpc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBLZXlDb2RlIH0gZnJvbSBcIi4uL2tleWNvZGUva2V5X2NvZGUudHNcIjtcbmltcG9ydCB7XG4gIEdlbmVyaWNJbnB1dCxcbiAgR2VuZXJpY0lucHV0S2V5cyxcbiAgR2VuZXJpY0lucHV0UHJvbXB0T3B0aW9ucyxcbiAgR2VuZXJpY0lucHV0UHJvbXB0U2V0dGluZ3MsXG59IGZyb20gXCIuL19nZW5lcmljX2lucHV0LnRzXCI7XG5pbXBvcnQgeyBib2xkLCBicmlnaHRCbHVlLCBkaW0sIHN0cmlwQ29sb3IgfSBmcm9tIFwiLi9kZXBzLnRzXCI7XG5pbXBvcnQgeyBGaWd1cmVzLCBnZXRGaWd1cmVzQnlLZXlzIH0gZnJvbSBcIi4vZmlndXJlcy50c1wiO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tIFwiLi4vX3V0aWxzL2Rpc3RhbmNlLnRzXCI7XG5cbi8qKiBTZWxlY3Qga2V5IG9wdGlvbnMuICovXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyaWNMaXN0S2V5cyBleHRlbmRzIEdlbmVyaWNJbnB1dEtleXMge1xuICBwcmV2aW91cz86IHN0cmluZ1tdO1xuICBuZXh0Pzogc3RyaW5nW107XG4gIHByZXZpb3VzUGFnZT86IHN0cmluZ1tdO1xuICBuZXh0UGFnZT86IHN0cmluZ1tdO1xufVxuXG4vKiogR2VuZXJpYyBsaXN0IG9wdGlvbiBvcHRpb25zLiAqL1xuZXhwb3J0IGludGVyZmFjZSBHZW5lcmljTGlzdE9wdGlvbiB7XG4gIHZhbHVlOiBzdHJpbmc7XG4gIG5hbWU/OiBzdHJpbmc7XG4gIGRpc2FibGVkPzogYm9vbGVhbjtcbn1cblxuLyoqIEdlbmVyaWMgbGlzdCBvcHRpb24gc2V0dGluZ3MuICovXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyaWNMaXN0T3B0aW9uU2V0dGluZ3MgZXh0ZW5kcyBHZW5lcmljTGlzdE9wdGlvbiB7XG4gIG5hbWU6IHN0cmluZztcbiAgdmFsdWU6IHN0cmluZztcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCB0eXBlIEdlbmVyaWNMaXN0VmFsdWVPcHRpb25zID0gKHN0cmluZyB8IEdlbmVyaWNMaXN0T3B0aW9uKVtdO1xuZXhwb3J0IHR5cGUgR2VuZXJpY0xpc3RWYWx1ZVNldHRpbmdzID0gR2VuZXJpY0xpc3RPcHRpb25TZXR0aW5nc1tdO1xuXG50eXBlIFVuc3VwcG9ydGVkSW5wdXRPcHRpb25zID0gXCJzdWdnZXN0aW9uc1wiIHwgXCJsaXN0XCI7XG5cbi8qKiBHZW5lcmljIGxpc3QgcHJvbXB0IG9wdGlvbnMuICovXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyaWNMaXN0T3B0aW9uczxUVmFsdWUsIFRSYXdWYWx1ZT4gZXh0ZW5kc1xuICBPbWl0PFxuICAgIEdlbmVyaWNJbnB1dFByb21wdE9wdGlvbnM8VFZhbHVlLCBUUmF3VmFsdWU+LFxuICAgIFVuc3VwcG9ydGVkSW5wdXRPcHRpb25zXG4gID4ge1xuICBvcHRpb25zOiBHZW5lcmljTGlzdFZhbHVlT3B0aW9ucztcbiAga2V5cz86IEdlbmVyaWNMaXN0S2V5cztcbiAgaW5kZW50Pzogc3RyaW5nO1xuICBsaXN0UG9pbnRlcj86IHN0cmluZztcbiAgc2VhcmNoSWNvbj86IHN0cmluZztcbiAgbWF4Um93cz86IG51bWJlcjtcbiAgc2VhcmNoTGFiZWw/OiBzdHJpbmc7XG4gIHNlYXJjaD86IGJvb2xlYW47XG4gIGluZm8/OiBib29sZWFuO1xufVxuXG4vKiogR2VuZXJpYyBsaXN0IHByb21wdCBzZXR0aW5ncy4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR2VuZXJpY0xpc3RTZXR0aW5nczxUVmFsdWUsIFRSYXdWYWx1ZT5cbiAgZXh0ZW5kcyBHZW5lcmljSW5wdXRQcm9tcHRTZXR0aW5nczxUVmFsdWUsIFRSYXdWYWx1ZT4ge1xuICBvcHRpb25zOiBHZW5lcmljTGlzdFZhbHVlU2V0dGluZ3M7XG4gIGtleXM/OiBHZW5lcmljTGlzdEtleXM7XG4gIGluZGVudDogc3RyaW5nO1xuICBsaXN0UG9pbnRlcjogc3RyaW5nO1xuICBtYXhSb3dzOiBudW1iZXI7XG4gIHNlYXJjaExhYmVsOiBzdHJpbmc7XG4gIHNlYXJjaD86IGJvb2xlYW47XG4gIGluZm8/OiBib29sZWFuO1xufVxuXG4vKiogR2VuZXJpYyBsaXN0IHByb21wdCByZXByZXNlbnRhdGlvbi4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBHZW5lcmljTGlzdDxcbiAgVFZhbHVlLFxuICBUUmF3VmFsdWUsXG4gIFRTZXR0aW5ncyBleHRlbmRzIEdlbmVyaWNMaXN0U2V0dGluZ3M8VFZhbHVlLCBUUmF3VmFsdWU+LFxuPiBleHRlbmRzIEdlbmVyaWNJbnB1dDxUVmFsdWUsIFRSYXdWYWx1ZSwgVFNldHRpbmdzPiB7XG4gIHByb3RlY3RlZCBvcHRpb25zOiBUU2V0dGluZ3NbXCJvcHRpb25zXCJdID0gdGhpcy5zZXR0aW5ncy5vcHRpb25zO1xuICBwcm90ZWN0ZWQgbGlzdEluZGV4OiBudW1iZXIgPSB0aGlzLmdldExpc3RJbmRleCgpO1xuICBwcm90ZWN0ZWQgbGlzdE9mZnNldDogbnVtYmVyID0gdGhpcy5nZXRQYWdlT2Zmc2V0KHRoaXMubGlzdEluZGV4KTtcblxuICAvKipcbiAgICogQ3JlYXRlIGxpc3Qgc2VwYXJhdG9yLlxuICAgKiBAcGFyYW0gbGFiZWwgU2VwYXJhdG9yIGxhYmVsLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBzZXBhcmF0b3IobGFiZWwgPSBcIi0tLS0tLS0tLS0tLVwiKTogR2VuZXJpY0xpc3RPcHRpb24ge1xuICAgIHJldHVybiB7IHZhbHVlOiBsYWJlbCwgZGlzYWJsZWQ6IHRydWUgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgbGlzdCBvcHRpb24gZGVmYXVsdHMuXG4gICAqIEBwYXJhbSBvcHRpb24gTGlzdCBvcHRpb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgc3RhdGljIG1hcE9wdGlvbihcbiAgICBvcHRpb246IEdlbmVyaWNMaXN0T3B0aW9uLFxuICApOiBHZW5lcmljTGlzdE9wdGlvblNldHRpbmdzIHtcbiAgICByZXR1cm4ge1xuICAgICAgdmFsdWU6IG9wdGlvbi52YWx1ZSxcbiAgICAgIG5hbWU6IHR5cGVvZiBvcHRpb24ubmFtZSA9PT0gXCJ1bmRlZmluZWRcIiA/IG9wdGlvbi52YWx1ZSA6IG9wdGlvbi5uYW1lLFxuICAgICAgZGlzYWJsZWQ6ICEhb3B0aW9uLmRpc2FibGVkLFxuICAgIH07XG4gIH1cblxuICBjb25zdHJ1Y3RvcihzZXR0aW5nczogVFNldHRpbmdzKSB7XG4gICAgc3VwZXIoe1xuICAgICAgLi4uc2V0dGluZ3MsXG4gICAgICBrZXlzOiB7XG4gICAgICAgIHByZXZpb3VzOiBzZXR0aW5ncy5zZWFyY2ggPyBbXCJ1cFwiXSA6IFtcInVwXCIsIFwidVwiLCBcInBcIiwgXCI4XCJdLFxuICAgICAgICBuZXh0OiBzZXR0aW5ncy5zZWFyY2ggPyBbXCJkb3duXCJdIDogW1wiZG93blwiLCBcImRcIiwgXCJuXCIsIFwiMlwiXSxcbiAgICAgICAgcHJldmlvdXNQYWdlOiBbXCJwYWdldXBcIiwgXCJsZWZ0XCJdLFxuICAgICAgICBuZXh0UGFnZTogW1wicGFnZWRvd25cIiwgXCJyaWdodFwiXSxcbiAgICAgICAgLi4uKHNldHRpbmdzLmtleXMgPz8ge30pLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBtYXRjaCgpOiB2b2lkIHtcbiAgICBjb25zdCBpbnB1dDogc3RyaW5nID0gdGhpcy5nZXRDdXJyZW50SW5wdXRWYWx1ZSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKCFpbnB1dC5sZW5ndGgpIHtcbiAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuc2V0dGluZ3Mub3B0aW9ucy5zbGljZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLnNldHRpbmdzLm9wdGlvbnNcbiAgICAgICAgLmZpbHRlcigob3B0aW9uOiBHZW5lcmljTGlzdE9wdGlvblNldHRpbmdzKSA9PlxuICAgICAgICAgIG1hdGNoKG9wdGlvbi5uYW1lKSB8fFxuICAgICAgICAgIChvcHRpb24ubmFtZSAhPT0gb3B0aW9uLnZhbHVlICYmIG1hdGNoKG9wdGlvbi52YWx1ZSkpXG4gICAgICAgIClcbiAgICAgICAgLnNvcnQoKGE6IEdlbmVyaWNMaXN0T3B0aW9uU2V0dGluZ3MsIGI6IEdlbmVyaWNMaXN0T3B0aW9uU2V0dGluZ3MpID0+XG4gICAgICAgICAgZGlzdGFuY2UoYS5uYW1lLCBpbnB1dCkgLSBkaXN0YW5jZShiLm5hbWUsIGlucHV0KVxuICAgICAgICApO1xuICAgIH1cbiAgICB0aGlzLmxpc3RJbmRleCA9IE1hdGgubWF4KFxuICAgICAgMCxcbiAgICAgIE1hdGgubWluKHRoaXMub3B0aW9ucy5sZW5ndGggLSAxLCB0aGlzLmxpc3RJbmRleCksXG4gICAgKTtcbiAgICB0aGlzLmxpc3RPZmZzZXQgPSBNYXRoLm1heChcbiAgICAgIDAsXG4gICAgICBNYXRoLm1pbihcbiAgICAgICAgdGhpcy5vcHRpb25zLmxlbmd0aCAtIHRoaXMuZ2V0TGlzdEhlaWdodCgpLFxuICAgICAgICB0aGlzLmxpc3RPZmZzZXQsXG4gICAgICApLFxuICAgICk7XG5cbiAgICBmdW5jdGlvbiBtYXRjaCh2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICByZXR1cm4gc3RyaXBDb2xvcih2YWx1ZSlcbiAgICAgICAgLnRvTG93ZXJDYXNlKClcbiAgICAgICAgLmluY2x1ZGVzKGlucHV0KTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgbWVzc2FnZSgpOiBzdHJpbmcge1xuICAgIGxldCBtZXNzYWdlID0gYCR7dGhpcy5zZXR0aW5ncy5pbmRlbnR9JHt0aGlzLnNldHRpbmdzLnByZWZpeH1gICtcbiAgICAgIGJvbGQodGhpcy5zZXR0aW5ncy5tZXNzYWdlKSArXG4gICAgICB0aGlzLmRlZmF1bHRzKCk7XG4gICAgaWYgKHRoaXMuc2V0dGluZ3Muc2VhcmNoKSB7XG4gICAgICBtZXNzYWdlICs9IFwiIFwiICsgdGhpcy5zZXR0aW5ncy5zZWFyY2hMYWJlbCArIFwiIFwiO1xuICAgIH1cbiAgICB0aGlzLmN1cnNvci54ID0gc3RyaXBDb2xvcihtZXNzYWdlKS5sZW5ndGggKyB0aGlzLmlucHV0SW5kZXggKyAxO1xuICAgIHJldHVybiBtZXNzYWdlICsgdGhpcy5pbnB1dCgpO1xuICB9XG5cbiAgLyoqIFJlbmRlciBvcHRpb25zLiAqL1xuICBwcm90ZWN0ZWQgYm9keSgpOiBzdHJpbmcgfCBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmdldExpc3QoKSArIHRoaXMuZ2V0SW5mbygpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEluZm8oKTogc3RyaW5nIHtcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MuaW5mbykge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICAgIGNvbnN0IHNlbGVjdGVkOiBudW1iZXIgPSB0aGlzLmxpc3RJbmRleCArIDE7XG4gICAgY29uc3QgYWN0aW9uczogQXJyYXk8W3N0cmluZywgQXJyYXk8c3RyaW5nPl0+ID0gW1xuICAgICAgW1wiTmV4dFwiLCBnZXRGaWd1cmVzQnlLZXlzKHRoaXMuc2V0dGluZ3Mua2V5cz8ubmV4dCA/PyBbXSldLFxuICAgICAgW1wiUHJldmlvdXNcIiwgZ2V0RmlndXJlc0J5S2V5cyh0aGlzLnNldHRpbmdzLmtleXM/LnByZXZpb3VzID8/IFtdKV0sXG4gICAgICBbXCJOZXh0IFBhZ2VcIiwgZ2V0RmlndXJlc0J5S2V5cyh0aGlzLnNldHRpbmdzLmtleXM/Lm5leHRQYWdlID8/IFtdKV0sXG4gICAgICBbXG4gICAgICAgIFwiUHJldmlvdXMgUGFnZVwiLFxuICAgICAgICBnZXRGaWd1cmVzQnlLZXlzKHRoaXMuc2V0dGluZ3Mua2V5cz8ucHJldmlvdXNQYWdlID8/IFtdKSxcbiAgICAgIF0sXG4gICAgICBbXCJTdWJtaXRcIiwgZ2V0RmlndXJlc0J5S2V5cyh0aGlzLnNldHRpbmdzLmtleXM/LnN1Ym1pdCA/PyBbXSldLFxuICAgIF07XG5cbiAgICByZXR1cm4gXCJcXG5cIiArIHRoaXMuc2V0dGluZ3MuaW5kZW50ICsgYnJpZ2h0Qmx1ZShGaWd1cmVzLklORk8pICtcbiAgICAgIGJvbGQoYCAke3NlbGVjdGVkfS8ke3RoaXMub3B0aW9ucy5sZW5ndGh9IGApICtcbiAgICAgIGFjdGlvbnNcbiAgICAgICAgLm1hcCgoY3VyKSA9PiBgJHtjdXJbMF19OiAke2JvbGQoY3VyWzFdLmpvaW4oXCIsIFwiKSl9YClcbiAgICAgICAgLmpvaW4oXCIsIFwiKTtcbiAgfVxuXG4gIC8qKiBSZW5kZXIgb3B0aW9ucyBsaXN0LiAqL1xuICBwcm90ZWN0ZWQgZ2V0TGlzdCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGxpc3Q6IEFycmF5PHN0cmluZz4gPSBbXTtcbiAgICBjb25zdCBoZWlnaHQ6IG51bWJlciA9IHRoaXMuZ2V0TGlzdEhlaWdodCgpO1xuICAgIGZvciAobGV0IGkgPSB0aGlzLmxpc3RPZmZzZXQ7IGkgPCB0aGlzLmxpc3RPZmZzZXQgKyBoZWlnaHQ7IGkrKykge1xuICAgICAgbGlzdC5wdXNoKFxuICAgICAgICB0aGlzLmdldExpc3RJdGVtKFxuICAgICAgICAgIHRoaXMub3B0aW9uc1tpXSxcbiAgICAgICAgICB0aGlzLmxpc3RJbmRleCA9PT0gaSxcbiAgICAgICAgKSxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICghbGlzdC5sZW5ndGgpIHtcbiAgICAgIGxpc3QucHVzaChcbiAgICAgICAgdGhpcy5zZXR0aW5ncy5pbmRlbnQgKyBkaW0oXCIgIE5vIG1hdGNoZXMuLi5cIiksXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gbGlzdC5qb2luKFwiXFxuXCIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciBvcHRpb24uXG4gICAqIEBwYXJhbSBpdGVtICAgICAgICBPcHRpb24uXG4gICAqIEBwYXJhbSBpc1NlbGVjdGVkICBTZXQgdG8gdHJ1ZSBpZiBvcHRpb24gaXMgc2VsZWN0ZWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgZ2V0TGlzdEl0ZW0oXG4gICAgaXRlbTogR2VuZXJpY0xpc3RPcHRpb25TZXR0aW5ncyxcbiAgICBpc1NlbGVjdGVkPzogYm9vbGVhbixcbiAgKTogc3RyaW5nO1xuXG4gIC8qKiBHZXQgb3B0aW9ucyByb3cgaGVpZ2h0LiAqL1xuICBwcm90ZWN0ZWQgZ2V0TGlzdEhlaWdodCgpOiBudW1iZXIge1xuICAgIHJldHVybiBNYXRoLm1pbihcbiAgICAgIHRoaXMub3B0aW9ucy5sZW5ndGgsXG4gICAgICB0aGlzLnNldHRpbmdzLm1heFJvd3MgfHwgdGhpcy5vcHRpb25zLmxlbmd0aCxcbiAgICApO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldExpc3RJbmRleCh2YWx1ZT86IHN0cmluZykge1xuICAgIHJldHVybiBNYXRoLm1heChcbiAgICAgIDAsXG4gICAgICB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCJcbiAgICAgICAgPyB0aGlzLm9wdGlvbnMuZmluZEluZGV4KChpdGVtOiBHZW5lcmljTGlzdE9wdGlvblNldHRpbmdzKSA9PlxuICAgICAgICAgICFpdGVtLmRpc2FibGVkXG4gICAgICAgICkgfHwgMFxuICAgICAgICA6IHRoaXMub3B0aW9ucy5maW5kSW5kZXgoKGl0ZW06IEdlbmVyaWNMaXN0T3B0aW9uU2V0dGluZ3MpID0+XG4gICAgICAgICAgaXRlbS52YWx1ZSA9PT0gdmFsdWVcbiAgICAgICAgKSB8fCAwLFxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0UGFnZU9mZnNldChpbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3QgaGVpZ2h0OiBudW1iZXIgPSB0aGlzLmdldExpc3RIZWlnaHQoKTtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihpbmRleCAvIGhlaWdodCkgKiBoZWlnaHQ7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBvcHRpb24gYnkgdmFsdWUuXG4gICAqIEBwYXJhbSB2YWx1ZSBWYWx1ZSBvZiB0aGUgb3B0aW9uLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldE9wdGlvbkJ5VmFsdWUoXG4gICAgdmFsdWU6IHN0cmluZyxcbiAgKTogR2VuZXJpY0xpc3RPcHRpb25TZXR0aW5ncyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5maW5kKChvcHRpb24pID0+IG9wdGlvbi52YWx1ZSA9PT0gdmFsdWUpO1xuICB9XG5cbiAgLyoqIFJlYWQgdXNlciBpbnB1dC4gKi9cbiAgcHJvdGVjdGVkIHJlYWQoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLnNldHRpbmdzLnNlYXJjaCkge1xuICAgICAgdGhpcy50dHkuY3Vyc29ySGlkZSgpO1xuICAgIH1cbiAgICByZXR1cm4gc3VwZXIucmVhZCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB1c2VyIGlucHV0IGV2ZW50LlxuICAgKiBAcGFyYW0gZXZlbnQgS2V5IGV2ZW50LlxuICAgKi9cbiAgcHJvdGVjdGVkIGFzeW5jIGhhbmRsZUV2ZW50KGV2ZW50OiBLZXlDb2RlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICBjYXNlIHRoaXMuaXNLZXkodGhpcy5zZXR0aW5ncy5rZXlzLCBcInByZXZpb3VzXCIsIGV2ZW50KTpcbiAgICAgICAgdGhpcy5zZWxlY3RQcmV2aW91cygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5pc0tleSh0aGlzLnNldHRpbmdzLmtleXMsIFwibmV4dFwiLCBldmVudCk6XG4gICAgICAgIHRoaXMuc2VsZWN0TmV4dCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5pc0tleSh0aGlzLnNldHRpbmdzLmtleXMsIFwibmV4dFBhZ2VcIiwgZXZlbnQpOlxuICAgICAgICB0aGlzLnNlbGVjdE5leHRQYWdlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmlzS2V5KHRoaXMuc2V0dGluZ3Mua2V5cywgXCJwcmV2aW91c1BhZ2VcIiwgZXZlbnQpOlxuICAgICAgICB0aGlzLnNlbGVjdFByZXZpb3VzUGFnZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGF3YWl0IHN1cGVyLmhhbmRsZUV2ZW50KGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgbW92ZUN1cnNvckxlZnQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc2V0dGluZ3Muc2VhcmNoKSB7XG4gICAgICBzdXBlci5tb3ZlQ3Vyc29yTGVmdCgpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBtb3ZlQ3Vyc29yUmlnaHQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc2V0dGluZ3Muc2VhcmNoKSB7XG4gICAgICBzdXBlci5tb3ZlQ3Vyc29yUmlnaHQoKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgZGVsZXRlQ2hhcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5zZWFyY2gpIHtcbiAgICAgIHN1cGVyLmRlbGV0ZUNoYXIoKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgZGVsZXRlQ2hhclJpZ2h0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnNldHRpbmdzLnNlYXJjaCkge1xuICAgICAgc3VwZXIuZGVsZXRlQ2hhclJpZ2h0KCk7XG4gICAgICB0aGlzLm1hdGNoKCk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGFkZENoYXIoY2hhcjogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc2V0dGluZ3Muc2VhcmNoKSB7XG4gICAgICBzdXBlci5hZGRDaGFyKGNoYXIpO1xuICAgICAgdGhpcy5tYXRjaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBTZWxlY3QgcHJldmlvdXMgb3B0aW9uLiAqL1xuICBwcm90ZWN0ZWQgc2VsZWN0UHJldmlvdXMoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmxpc3RJbmRleCA+IDApIHtcbiAgICAgIHRoaXMubGlzdEluZGV4LS07XG4gICAgICBpZiAodGhpcy5saXN0SW5kZXggPCB0aGlzLmxpc3RPZmZzZXQpIHtcbiAgICAgICAgdGhpcy5saXN0T2Zmc2V0LS07XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zW3RoaXMubGlzdEluZGV4XS5kaXNhYmxlZCkge1xuICAgICAgICB0aGlzLnNlbGVjdFByZXZpb3VzKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubGlzdEluZGV4ID0gdGhpcy5vcHRpb25zLmxlbmd0aCAtIDE7XG4gICAgICB0aGlzLmxpc3RPZmZzZXQgPSB0aGlzLm9wdGlvbnMubGVuZ3RoIC0gdGhpcy5nZXRMaXN0SGVpZ2h0KCk7XG4gICAgICBpZiAodGhpcy5vcHRpb25zW3RoaXMubGlzdEluZGV4XS5kaXNhYmxlZCkge1xuICAgICAgICB0aGlzLnNlbGVjdFByZXZpb3VzKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqIFNlbGVjdCBuZXh0IG9wdGlvbi4gKi9cbiAgcHJvdGVjdGVkIHNlbGVjdE5leHQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmxpc3RJbmRleCA8IHRoaXMub3B0aW9ucy5sZW5ndGggLSAxKSB7XG4gICAgICB0aGlzLmxpc3RJbmRleCsrO1xuICAgICAgaWYgKHRoaXMubGlzdEluZGV4ID49IHRoaXMubGlzdE9mZnNldCArIHRoaXMuZ2V0TGlzdEhlaWdodCgpKSB7XG4gICAgICAgIHRoaXMubGlzdE9mZnNldCsrO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9uc1t0aGlzLmxpc3RJbmRleF0uZGlzYWJsZWQpIHtcbiAgICAgICAgdGhpcy5zZWxlY3ROZXh0KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubGlzdEluZGV4ID0gdGhpcy5saXN0T2Zmc2V0ID0gMDtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnNbdGhpcy5saXN0SW5kZXhdLmRpc2FibGVkKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0TmV4dCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKiBTZWxlY3QgcHJldmlvdXMgcGFnZS4gKi9cbiAgcHJvdGVjdGVkIHNlbGVjdFByZXZpb3VzUGFnZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5vcHRpb25zPy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IGhlaWdodDogbnVtYmVyID0gdGhpcy5nZXRMaXN0SGVpZ2h0KCk7XG4gICAgICBpZiAodGhpcy5saXN0T2Zmc2V0ID49IGhlaWdodCkge1xuICAgICAgICB0aGlzLmxpc3RJbmRleCAtPSBoZWlnaHQ7XG4gICAgICAgIHRoaXMubGlzdE9mZnNldCAtPSBoZWlnaHQ7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMubGlzdE9mZnNldCA+IDApIHtcbiAgICAgICAgdGhpcy5saXN0SW5kZXggLT0gdGhpcy5saXN0T2Zmc2V0O1xuICAgICAgICB0aGlzLmxpc3RPZmZzZXQgPSAwO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKiBTZWxlY3QgbmV4dCBwYWdlLiAqL1xuICBwcm90ZWN0ZWQgc2VsZWN0TmV4dFBhZ2UoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMub3B0aW9ucz8ubGVuZ3RoKSB7XG4gICAgICBjb25zdCBoZWlnaHQ6IG51bWJlciA9IHRoaXMuZ2V0TGlzdEhlaWdodCgpO1xuICAgICAgaWYgKHRoaXMubGlzdE9mZnNldCArIGhlaWdodCArIGhlaWdodCA8IHRoaXMub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5saXN0SW5kZXggKz0gaGVpZ2h0O1xuICAgICAgICB0aGlzLmxpc3RPZmZzZXQgKz0gaGVpZ2h0O1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmxpc3RPZmZzZXQgKyBoZWlnaHQgPCB0aGlzLm9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMub3B0aW9ucy5sZW5ndGggLSBoZWlnaHQ7XG4gICAgICAgIHRoaXMubGlzdEluZGV4ICs9IG9mZnNldCAtIHRoaXMubGlzdE9mZnNldDtcbiAgICAgICAgdGhpcy5saXN0T2Zmc2V0ID0gb2Zmc2V0O1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLFNBQ0UsWUFBWSxRQUlQLHNCQUFzQjtBQUM3QixTQUFTLElBQUksRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLFVBQVUsUUFBUSxZQUFZO0FBQzlELFNBQVMsT0FBTyxFQUFFLGdCQUFnQixRQUFRLGVBQWU7QUFDekQsU0FBUyxRQUFRLFFBQVEsd0JBQXdCO0FBMkRqRCx3Q0FBd0MsR0FDeEMsT0FBTyxNQUFlLG9CQUlaO0VBQ0UsVUFBZ0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7RUFDdEQsWUFBb0IsSUFBSSxDQUFDLFlBQVksR0FBRztFQUN4QyxhQUFxQixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7RUFFbEU7OztHQUdDLEdBQ0QsT0FBYyxVQUFVLFFBQVEsY0FBYyxFQUFxQjtJQUNqRSxPQUFPO01BQUUsT0FBTztNQUFPLFVBQVU7SUFBSztFQUN4QztFQUVBOzs7R0FHQyxHQUNELE9BQWlCLFVBQ2YsTUFBeUIsRUFDRTtJQUMzQixPQUFPO01BQ0wsT0FBTyxPQUFPLEtBQUs7TUFDbkIsTUFBTSxPQUFPLE9BQU8sSUFBSSxLQUFLLGNBQWMsT0FBTyxLQUFLLEdBQUcsT0FBTyxJQUFJO01BQ3JFLFVBQVUsQ0FBQyxDQUFDLE9BQU8sUUFBUTtJQUM3QjtFQUNGO0VBRUEsWUFBWSxRQUFtQixDQUFFO0lBQy9CLEtBQUssQ0FBQztNQUNKLEdBQUcsUUFBUTtNQUNYLE1BQU07UUFDSixVQUFVLFNBQVMsTUFBTSxHQUFHO1VBQUM7U0FBSyxHQUFHO1VBQUM7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